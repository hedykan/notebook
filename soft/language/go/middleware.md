# 使用go编写中间件

## 是什么
啥是中间件？中间件(middleware)是一种类似复合函数的存在，像数学上的f(g(h(x)))里的函数f，函数g，函数h，嵌套计算。  
通俗点来说，就是可以把一组操作套在另一组的操作上面，让另一组操作也可以做到同样且更多的操作。  

## 为什么
为啥要用中间件？一般在后端处理或者消息传递中，有很多重复且必要的操作，比如读取报头，处理数据，包装数据等，要是在每个处理函数里都重写，累死是第一个，如果后面要改动一种操作，得每个处理函数都重写一遍，这时候把这些操作抽离出来，方便修改添加，就是为啥要用中间件的原因了！  

## 怎么办
那么要如何构建和使用中间件呢？  
要构建中间件，得首先从他的概念说起，中间件是一种把操作包装在被传递进来的函数的一种函数，那么，他在运行的时侯是不运行他提供的操作的。  
这么看来：  
1. 中间件的输入应该是一组有待加工的函数。  
2. 中间件运行时的操作，就是把目标操作包装进传入函数中，那么中间件首先是一个高阶函数，返回的应该是一个被包装好的函数。  
那么这里给出个go的函数原型：  
```golang
    func middleware(next func) func {
        return func () {
            // 一些操作，在传入的函数操作之前
            next()
            // 一些操作，在传入的函数操作之后
        }
    }
```
要使用中间件，其实就和复合函数中复合的方式一样：  
```golang
    midd1(midd2(midd3(handle)))()
```